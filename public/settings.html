<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>SmartMonitor • Settings</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <aside class="sidebar">
    <div class="logo">SmartMonitor</div>
    <nav>
      <a href="/">Dashboard</a>
      <a href="/analytics">Analytics</a>
      <a href="/settings" class="active">Settings</a>
    </nav>
  </aside>

  <main class="main">
    <header>
      <h1>Settings</h1>
    </header>

    <form id="settings-form" class="cards" style="max-width:600px; margin:0 auto; gap:1.5rem; display:grid; grid-template-columns:1fr;">
      <div class="card">
        <label for="co2-threshold" class="title">CO₂ Alert Threshold (ppm)</label>
        <input type="number" id="co2-threshold" min="400" max="2000" step="50" required>
      </div>

      <div class="card">
        <label for="break-interval" class="title">Break Reminder Interval (minutes)</label>
        <select id="break-interval">
          <option value="10">10</option>
          <option value="15">15</option>
          <option value="20">20</option>
        </select>
      </div>

      <div class="card">
        <label for="mute-alerts" class="title">Mute Alerts</label>
        <input type="checkbox" id="mute-alerts">
      </div>

      <div class="card" style="text-align:center;">
        <button type="submit">Save Settings</button>
      </div>
    </form>

    <div id="settings-status" style="text-align:center; margin-top:1.5rem; color:var(--accent);"></div>
  </main>

  <script>
    async function loadSettings() {
      try {
        const res = await fetch('/api/settings');
        const data = await res.json();
        document.getElementById('co2-threshold').value = data.co2Threshold;
        document.getElementById('break-interval').value = data.breakInterval;
        document.getElementById('mute-alerts').checked = data.muteAlerts;
      } catch (e) {
        console.error('Load settings error:', e);
      }
    }

    document.getElementById('settings-form').addEventListener('submit', async e => {
      e.preventDefault();
      const payload = {
        co2Threshold: Number(document.getElementById('co2-threshold').value),
        breakInterval: Number(document.getElementById('break-interval').value),
        muteAlerts: document.getElementById('mute-alerts').checked
      };
      try {
        const res = await fetch('/api/settings', {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify(payload)
        });
        document.getElementById('settings-status').textContent = res.ok ? 'Settings saved!' : 'Failed to save settings.';
      } catch (e) {
        document.getElementById('settings-status').textContent = 'Error saving settings.';
        console.error('Save settings error:', e);
      }
    });

    loadSettings();
  </script>
</body>
</html>
